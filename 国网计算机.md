## 数据链路层
1. 逻辑链路控制，LLC。组帧，差错控制，流量控制。
2. 介质访问控制，MAC。
### DHLC
DHLC帧，帧开始，目的地址，控制，数据，FCS，帧结束。
是面向bit的同步串行传输协议。差错控制 CRC。流量控制滑动窗口协议，既可以回退N帧，也可以选择重传。I帧 使用S标志表示当前发送帧，N标志表示希望接受到的下一个帧。S 帧和 U 帧都不携带数据，S 帧用于请求，确认。U 帧用于链路建立，拆除等控制信息。
### PPP
PPP帧与DHLC帧相同，帧开始，目的地址，控制，数据，FCS，帧结束。但是目的地址固定为广播地址，控制字段无意义。
1. 帧：异步使用字符填充法，7E 为帧定界符，如果数据部分出现 7E，改为 7D 5E，如果数据部分出现 7D，改为 7D 5D。同步使用字符填充法，以 01111110 作为帧定界，传输中每 5 个 1 填充一个0，结束时 还原。
2. 身份认证协议：PAP 密码认证协议。CHAP 挑战握手认证协议。
### 帧中继
面向连接的分组交换数据链路层协议，主要用于公共和专用的局域网以及广域网。
### 流量控制
1. 停止等待协议。每次发送一个数据包，当收到确认后再发下一个，超时重发。
2. 回退N帧协议。发送方维护一个大小为 t 发送窗口，接受方只有一个接受窗口。接受方对于每一个接受发送一个确认帧。发送方根据接受到的最大确认帧更新滑动窗口。超时重传没有收到确认还在窗口中的帧。
3. 选择重传协议。在回退 N 帧协议的基础上，接收方维护大小与发送方相同的滑动窗口，只重传没有收到 ACK 确认的帧。
### 介质访问控制
1. ALOHA，想法就发，冲突重发。
2. CSMA 协议。1-坚持，继续监听。p坚持，1-p概率离固定时间继续监听。非坚持，离随机时间继续监听。
3. CSMA/CD 协议。总线型以太网。争用期：数据在信道中的往返时间。数据如果在争用期内不冲突，就不会发生冲突。最小帧长 64字节，争用期可以发送的最小帧长。
4. CSMA/CA 协议。为了解决无线局域网中碰撞检测难和隐蔽站问题。先载波监听，再发送RTS发送请求，接收端返回CTS允许发送。再发送消息，并接受ACK帧。如果接受不到，一段时间后重传。
5. 载波监听冲突的退避算法。退避窗口，$2^k-1$ 。计算退避时间 $2r\tau$ ，$r$ 为退避窗口的随机数，$\tau$ 为基本退避时间，以太网为争用期  $51.2\mu s$ 。k最大为10，如果冲突次数大于16，不再重发，报告上级。
### 网桥与交换机
只能连接相同数据链路层与物理层的局域网。
## 网络层
### IP协议
1. `IP`数据报：版本，首部长度（4 byte 为单位），区分服务，总长度（1 byte 为单位），**标志（DF = 0 表示允许分片，MF = 1 表示还有分片）**，**片偏移（当前分组相对于原数据的相对位置，以 8 byte 为单位）**，**生存时间 TTL（表示数据报在网络中可通过的路由器的最大值，如果减为 0 则丢弃数据报）**，上层协议，**首部校验和（校验首部）**。
2. `IP`单播：单个地址单个接口。`IP`广播：广播地址，注意广播必须在同一个广播域才能进行广播，路由器不转发广播数据包，而是转化为MAC广播，IPv6已经不使用`IP`广播，不能出现跨广播域广播。`IP`组播：最后一个路由器才复制数据包，需要支持组播的路由器，特定的组播地址（D类地址）：224.0.0.0~239.255.255.255，不可作为源地址，包括硬件组播和IP组播，基于UDP，不产生ICMP差错报文。`IP`任播：单地址对应多主机。
3. 分片可以在信源和路由器，重组只能在目的机。
### 子网划分
1. `IP`地址分类：A类：0~126，B类：128.0~191.255，C类：192.255.255.0~223.255.255.0，D类：224.0.0.0~239.255.255.255 IP 组播地址，E类：240.0.0.0 ~255.255.255.255 用于研究。A类，B类，C类主机号长度不同。全0为网络地址，全1为广播地址。
2. 子网通过默认网关（路由器）进行通信。
3. 子网划分的核心目的是**优化 IP 地址资源利用、提升网络性能与安全性**。
4. CIDR，通过路由聚合缓解路由表过大的问题，高校IP地址分配。
### ARP
1. `ARP`协议与`RARP`用于`IP`地址与`MAC`地址的相互转化，其报文包含源`IP`，目的`IP`，源`MAC`，目的`MAC`。
2. `ARP`欺骗指攻击者伪造`ARP`响应报文，将自己的`MAC`地址伪装为其他主机的`MAC`地址。
### ISP
ISP即因特网服务提供商，向因特网管理机构申请IP地址并发放给用户，只提供IP地址，线路之类的由ISP自己完成。
### IGMP
组播组管理协议。主要是确定某个主机加入了某个组播组或退出了某个组。网络层协议，使用IP数据报传输。构建组播转发树。
### IPv6
1. 128bit，8 byte。
2. 简写，每两个字节加一个冒号，可以去掉前导0，对于每一个可以将全零最多的简写为::，注意只能简写一处。
3. 
### ICMP协议
`ICMP`是网络层协议，基于`IP`协议发送数据报，主要用于差错报告，请求查询/响应。差错报告可分为：目标不可达，超时(TTL 为 0)，头部错误（校验错误，字段非法）；请求查询/响应：检测主机连通性，路由重定向，时间戳请求（用于主机间的时间同步）。
### NAT
`NAT`网络地址转换协议用于私有和公有`IP`地址的转换。`NAT`会利用端口号映射，重写数据包的源`IP`地址或者目的`IP`地址。私有地址范围：10.0.0.0 ~ 10.255.255.255，172.16.0.0 ~ 172.31.255.255，192.168.0.0 ~ 192.168.255.255（最常用）
### DHCP
动态IP协议，基于UDP，属于应用层。
### 网关（路由）协议
1. 网关协议分为内部网关协议`IGP`和外部网关协议`BGP`。
2. 内部网关协议`IGP`。有`RIP`和`OSPF`。
3. `RIP`协议：`RIP`协议基于距离向量(通过路由器的数目)选择路由，认为距离向量最小的路由是最佳路由。`RIP`设定一条路径的距离向量最大为15，如果为16则认为不可达。`RIP`是应用层协议，基于`UDP`发送数据。`RIP`按照固定的时间与相邻路由器交换路由表信息。好消息传的快，坏消息传的慢。
4. `OSPF`协议：网络层协议。使用泛洪法传播路由信息，dijkstra计算最短路径，以网络带宽，延迟等链路状态作为度量，而不仅仅是跳数。
5. 外部网关协议`BGP`。`BGP`是应用层协议，基于`TCP`，使用AS（自治系统）路径长度作为度量。
6. 衡量路由算法的原则：快速收敛性；灵活性和弹性；最佳路径。

### 路由器
1. 异构网络互联。
2. 分割广播域。
3. 改善网络性能。
4. 过滤数据包。
5. 路由选择。
